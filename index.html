<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>潛能計算機</title>
    <style>
        body { 
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background-image: url('./image/薑餅人之塔_封面.webp');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        /* 添加一個暗色遮罩 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 調整最後的數值(0.5)來控制暗度 */
            z-index: -1;
        }

        /* 添加導航欄樣式 */
        .nav-tabs {
            display: flex;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            margin-bottom: 0;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .nav-tab {
            padding: 15px 30px;
            cursor: pointer;
            color: white;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab.active {
            background-color: rgba(0, 0, 0, 0.5);
            border-bottom: 3px solid var(--tower-gold, #ffd700);
        }
        
        .nav-tab:hover {
            background-color: rgba(0, 0, 0, 0.4);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }

        .container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0 auto 30px;
            max-width: 1200px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 0 0 15px 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        /* 页面2的样式 */
        .page2-content {
            color: white;
            text-align: center;
            padding: 40px 20px;
        }
        
        .page2-title {
            font-size: 32px;
            margin-bottom: 20px;
            color: var(--tower-gold, #ffd700);
        }
        
        .page2-description {
            font-size: 18px;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto 30px;
        }

        label { 
            font-size: 18px; 
            margin-bottom: 10px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            display: block;
            margin-bottom: 8px;
        }

        /* 卡片基本樣式 */
        .select-button {
            padding: 0;
            margin: 15px 8px;
            cursor: pointer;
            background-color: rgba(10, 10, 10, 0.7);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
            color: white;
            overflow: hidden;
            display: flex;
            flex-direction: column; /* 所有卡片垂直排列 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        /* 角色卡（正方形） */
        #characterButton {
            width: 200px;
            height: 240px;
            border: 3px solid #9c27b0;
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
        }
        
        #characterButton .button-img {
            width: 100%;
            height: 170px;
            border-right: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        /* 法寶卡和套裝（長條形，但文字在下方） */
        #treasureCardButton, #equipmentButton, 
        #assist1TreasureCardButton, #assist1EquipmentButton {
            width: 170px;
            height: 240px;
            border: 3px solid #e91e63;
            box-shadow: 0 0 15px rgba(233, 30, 99, 0.5);
        }
        
        #treasureCardButton .button-img, 
        #equipmentButton .button-img,
        #assist1TreasureCardButton .button-img, 
        #assist1EquipmentButton .button-img {
            width: 100%;
            height: 170px;
            border-right: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* 輔助角色（正方形） */
        #assist1Button {
            width: 200px;
            height: 240px;
            border: 3px solid #2196f3;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
        }
        
        #assist1Button .button-img {
            width: 100%;
            height: 170px;
            border-right: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        /* 輔助法寶卡和套裝 */
        #assist1TreasureCardButton, #assist1EquipmentButton {
            border: 3px solid #2196f3;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
        }

        .select-button .button-img {
            position: relative;
            width: 100%;
            height: 170px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-color: rgba(50, 50, 50, 0.5);
            border-right: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .select-button .button-text {
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            flex: 1;
            text-align: center;
        }

        /* 星級評分 */
        .select-button .card-rating {
            position: absolute;
            bottom: 5px;
            right: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 2px;
        }

        /* 等級顯示 */
        .select-button .card-level {
            display: none;
        }

        .cards-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            width: 100%;
            margin: 15px 0;
        }
        
        .cards-selection-container, .assist1-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        
        .selection-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }
        
        .selection-item label {
            margin-bottom: 8px;
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .select-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.4);
        }

        .select-button.selected {
            transform: translateY(-5px) scale(1.05);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
            100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        }

        /* 選擇容器佈局 */
        .selection-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px auto;
            width: 100%;
            max-width: 600px;
        }

        .selection-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }

        .selection-item label {
            margin-bottom: 10px;
            font-size: 18px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .modal-content {
            position: relative;
            background-color: rgba(255, 255, 255, 0.95);
            margin: 5% auto;
            padding: 25px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            padding: 15px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .option-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            height: 160px; /* 統一高度 */
        }

        .option-item:hover {
            background-color: #f0f0f0;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .option-item img {
            width: auto;
            height: 100px;
            max-width: 100px;
            object-fit: contain;
            margin-bottom: 8px;
        }
        
        .option-item div {
            text-align: center;
            word-break: break-word;
            max-width: 100%;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2; /* 添加標準屬性 */
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
            max-height: 2.6em; /* 支援非webkit瀏覽器的備選方案: 2 x line-height */
        }

        .option-item.selected {
            border: 2px solid #5cb85c;
            background-color: rgba(92, 184, 92, 0.1);
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            display: block;
        }
        
        .close:hover {
            color: #333;
        }
        
        #modalTitle {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background-color: rgba(255, 255, 255, 0.95);
            z-index: 1;
        }

        .result {
            width: 100%;
            margin-top: 30px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .result th, .result td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .result th {
            background-color: #f5f5f5;
            font-weight: bold;
        }

        .result tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #potentialResult {
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(to bottom, var(--cookie-dark), #3a2617);
            border-radius: 10px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            width: 100%;
            text-align: center;
            border: 2px solid var(--cookie-brown);
            box-shadow: 0 8px 16px var(--shadow);
        }
        
        #potentialResult .max-value {
            color: var(--tower-gold);
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        #potentialResult .best-distribution {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        #potentialResult .stat-point {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 5px 10px;
            display: inline-block;
        }
        
        #potentialResult .stat-name {
            color: var(--icing-white);
        }
        
        #potentialResult .point-value {
            color: var(--tower-gold);
            font-weight: bold;
            margin-left: 5px;
        }

        .current-damage .value {
            font-size: 32px;
            font-weight: bold;
            color: var(--icing-white);
        }

        #cornerText {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 12px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background-color: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 5px;
        }

        /* 調整輔助相關容器 */
        .assist1-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0 25px;
            align-items: center;
        }
        
        .assist-additional-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 25px;
            justify-content: center;
            width: 100%;
        }
        
        .assist-additional-container .selection-item {
            flex: 1;
            min-width: 320px;
            max-width: 450px;
        }
        
        /* 輔助增益控制區域優化 */
        .assist-boost-controls {
            background-color: rgba(33, 150, 243, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            border: 2px solid rgba(33, 150, 243, 0.5);
            max-width: 700px;
            width: 100%;
        }
        
        .assist-boost-controls.active {
            display: block;
        }
        
        .assist-boost-label {
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 20px;
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }
        
        .assist-boost-slider {
            width: 100%;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .assist-boost-slider input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #1976d2, #64b5f6);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            transition: all 0.3s;
        }
        
        .assist-boost-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #2196f3;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .assist-boost-slider input[type="number"] {
            width: 70px;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.2);
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        .assist-boost-slider span {
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .assist-boost-preview {
            margin-top: 15px;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .boost-stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 16px;
        }
        
        .boost-stat-name {
            color: #ffffff;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .boost-stat-value {
            font-weight: bold;
            color: #4caf50;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .auto-optimize-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            background-color: var(--tower-blue);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .auto-optimize-btn:hover {
            background-color: #4c7db8;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px var(--shadow);
        }

        .auto-optimize-btn .icon {
            margin-right: 8px;
            font-size: 18px;
        }

        .damage-preview-card {
            background: linear-gradient(to bottom, var(--cookie-dark), #3a2617);
            border-radius: 16px;
            box-shadow: 0 8px 16px var(--shadow);
            padding: 24px;
            color: var(--icing-white);
            max-width: 580px;
            margin: 20px auto;
            border: 2px solid var(--cookie-brown);
            width: 100%;
        }

        .damage-preview-card h3 {
            text-align: center;
            margin-top: 0;
            color: var(--tower-gold);
            font-size: 22px;
        }

        .damage-value {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            gap: 20px;
        }

        .current-damage {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .current-damage .label {
            font-size: 14px;
            color: #aaa;
        }

        .damage-change {
            display: flex;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
        }

        .damage-change.positive {
            color: #4CAF50;
        }

        .damage-change.negative {
            color: #f44336;
        }

        .breakdown-header {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--tower-gold);
        }

        .breakdown-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .bar-label {
            flex: 0 0 120px;
            text-align: right;
            padding-right: 10px;
            font-size: 14px;
        }

        .bar-container {
            flex: 1;
            height: 12px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background-color: var(--tower-gold);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .bar-value {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: var(--cookie-dark);
            font-weight: bold;
        }

        .slider-handle.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .damage-value.optimized .current-damage .value {
            animation: pulse 1.5s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: var(--tower-gold); }
            100% { transform: scale(1); }
        }

        /* 輔助增益調整相關樣式 */
        .assist-boost-controls {
            background-color: rgba(33, 150, 243, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            border: 2px solid rgba(33, 150, 243, 0.5);
            max-width: 700px;
            width: 100%;
        }
        
        .assist-boost-controls.active {
            display: block;
        }
        
        .assist-boost-slider {
            width: 100%;
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        
        .assist-boost-slider input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--cookie-light), var(--cookie-brown));
            outline: none;
            margin: 0 10px;
        }
        
        .assist-boost-slider input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
        }
        
        .assist-boost-preview {
            margin-top: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 8px;
        }
        
        .boost-stat-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .boost-stat-name {
            color: var(--cookie-dark);
        }
        
        .boost-stat-value {
            font-weight: bold;
            color: #4CAF50;
        }

        /* 新增選擇項目容器樣式 */
        .selection-item {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap; /* 允許在小螢幕上換行 */
            justify-content: center; /* 居中顯示 */
            width: 100%;
        }
        
        .selection-item label {
            width: 100%;
            text-align: center;
            margin-right: 0;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 20px;
        }

        .selection-preview {
            display: flex;
            align-items: center;
            margin-left: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 5px 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .selection-preview img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-right: 10px;
        }

        .selection-preview .name {
            font-weight: bold;
            color: #333;
        }

        .option-item.selected {
            border: 2px solid #5cb85c;
            background-color: rgba(92, 184, 92, 0.1);
        }

        .modal-search {
            margin: 10px 0 20px;
            padding: 0 15px;
            position: sticky;
            top: 65px; /* 標題下方 */
            z-index: 1;
            background-color: rgba(255, 255, 255, 0.95);
            padding-bottom: 15px;
        }
        
        .modal-search input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .modal-search input::placeholder {
            color: #999;
        }
        
        .modal-search input:focus {
            outline: none;
            border-color: var(--cookie-brown, #a5682a);
            box-shadow: 0 2px 5px rgba(165, 104, 42, 0.2);
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
            display: block;
        }

        select { padding: 5px; font-size: 16px; margin-bottom: 20px; }
        table { border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 5px; }
        #cornerText {position: fixed;bottom: 10px;right: 10px;font-size: 12px;color: #666;}
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
        }
        
        /* 潜能点数分配界面样式 */
        :root {
            --cookie-brown: #a5682a;
            --cookie-light: #dfb78c;
            --cookie-dark: #65422d;
            --icing-white: #f5f5f5;
            --icing-pink: #ffb7c5;
            --tower-blue: #5c8dc9;
            --tower-gold: #ffd700;
            --shadow: rgba(0, 0, 0, 0.2);
        }

        .potential-allocation-card {
            background: linear-gradient(to bottom, var(--cookie-light), #e3c8a6);
            border-radius: 16px;
            box-shadow: 0 8px 16px var(--shadow);
            padding: 24px;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            color: var(--cookie-dark);
            max-width: 580px;
            margin: 20px auto;
            border: 2px solid var(--cookie-brown);
            width: 100%;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--cookie-brown);
            padding-bottom: 12px;
        }

        .card-header h3 {
            font-size: 22px;
            font-weight: bold;
            color: var(--cookie-dark);
            margin: 0;
        }

        .points-counter {
            background-color: var(--cookie-brown);
            color: var(--icing-white);
            padding: 8px 12px;
            border-radius: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .remaining-value {
            font-size: 20px;
            margin: 0 4px;
            color: var(--tower-gold);
        }

        .stat-slider {
            margin-bottom: 20px;
            position: relative;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        /* 新增加減按鈕樣式 */
        .point-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .control-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--cookie-brown);
            color: white;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px var(--shadow);
        }
        
        .control-button:hover {
            background-color: #85521e;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px var(--shadow);
        }
        
        .control-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px var(--shadow);
        }
        
        .control-button.minus {
            background-color: #8b5927;
        }
        
        .control-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .point-value-display {
            font-size: 24px;
            font-weight: bold;
            color: var(--cookie-dark);
            width: 40px;
            text-align: center;
        }
        
        .stat-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .stat-bonus {
            color: #4CAF50;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .stat-name {
            font-weight: bold;
            font-size: 16px;
            color: var(--cookie-dark);
        }
        
        /* 移除舊的滑桿樣式 */
        .slider-container, .slider-track, .slider-fill, .slider-handle, .slider-markers, .marker {
            display: none;
        }

        .reset-button-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .reset-button {
            padding: 10px 24px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .reset-button:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        /* 提交按鈕樣式優化 */
        .submit-button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            margin-top: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(255, 77, 77, 0.3);
        }
        
        .submit-button:hover {
            background-color: #ff3333;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 77, 77, 0.4);
        }

        /* 選擇容器佈局 */
        .selection-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px auto;
            width: 100%;
            max-width: 450px;
        }

        /* 新增的布局樣式 */
        .cards-selection-container {
            width: 100%;
            margin-bottom: 30px;
        }
        
        .section-title {
            color: #ffd700;
            font-size: 22px;
            text-align: center;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .cards-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px -8px;
        }
        
        .assist1-container {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 新的橫向排列樣式 */
        .horizontal-cards-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            width: 100%;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .card-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-item label {
            color: white;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        
        .section-title {
            color: #ffd700;
            text-align: center;
            margin: 25px 0 10px;
            font-size: 22px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .select-button .button-img img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        
        .select-button .default-icon {
            color: white;
            font-size: 36px;
            font-weight: bold;
        }

        /* 完全移除潛能分配區域的特殊樣式，確保所有屬性顯示相同 */
        .stat-slider[data-stat="attributeDamage"] .stat-name,
        .stat-slider[data-stat="critDamage"] .stat-name {
            color: var(--cookie-dark, #65422d); /* 使用與其他屬性相同的顏色 */
            font-size: 16px;
            font-weight: bold;
            text-shadow: none;
        }
        
        .stat-slider[data-stat="attributeDamage"] .stat-bonus,
        .stat-slider[data-stat="critDamage"] .stat-bonus {
            color: #4CAF50; /* 恢復為綠色，與其他屬性相同 */
            font-size: 16px;
            font-weight: bold;
        }
        
        /* 所有屬性的統一樣式 */
        .stat-slider .stat-name {
            color: var(--cookie-dark, #65422d);
            font-size: 16px;
            font-weight: bold;
        }
        
        .stat-slider .stat-bonus {
            color: #4CAF50;
            font-weight: bold;
        }

        /* 添加說明文字的樣式 */
        .modal-note {
            background-color: rgba(255, 248, 225, 0.9);
            color: #795548;
            padding: 10px 15px;
            margin: 0 15px 15px;
            border-radius: 8px;
            font-size: 15px;
            display: flex;
            align-items: center;
            border-left: 4px solid #ff9800;
        }
        
        .note-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        
        /* 保留表格中的高亮 */
        #attributeDamageSum,
        #critDamageSum {
            font-weight: normal;
            color: inherit;
            background-color: inherit;
        }
        
        /* 只保留增益預覽區高亮 */
        .highlight-stat {
            color: #ff9800 !important;
            text-shadow: 0 0 3px rgba(255, 152, 0, 0.3) !important;
            font-weight: bold !important;
        }

        /* 方案管理樣式 */
        .plan-management, .plan-comparison {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .plan-management h4, .plan-comparison h4 {
            color: var(--tower-gold);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 5px;
        }
        
        .plan-controls, .comparison-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .plan-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .plan-input, .plan-select, .comparison-select {
            flex: 1;
            min-width: 150px;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .plan-button, .comparison-button {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            min-width: 100px;
        }
        
        .save-button {
            background-color: #4CAF50;
        }
        
        .load-button {
            background-color: #2196F3;
        }
        
        .delete-button {
            background-color: #F44336;
        }
        
        .export-button, .import-button {
            background-color: #9C27B0;
        }
        
        .comparison-button {
            background-color: var(--tower-blue);
        }
        
        .plan-button:hover, .comparison-button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .comparison-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .vs-label {
            font-weight: bold;
            color: var(--tower-gold);
            font-size: 18px;
            margin: 0 5px;
        }
        
        .comparison-result {
            margin-top: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            display: none;
        }
        
        .comparison-result.active {
            display: block;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            color: white;
        }
        
        .comparison-table th, .comparison-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .comparison-table th {
            background-color: rgba(0, 0, 0, 0.3);
            color: var(--tower-gold);
        }
        
        .comparison-metric {
            background-color: rgba(0, 0, 0, 0.2);
            font-weight: bold;
        }
        
        .better-value {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .worse-value {
            color: #F44336;
        }
        
        .comparison-chart {
            height: 300px;
            margin-top: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            position: relative;
        }
        
        .chart-bar {
            position: absolute;
            bottom: 50px;
            width: 60px;
            background-image: linear-gradient(to top, var(--tower-blue), #64B5F6);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 12px;
        }
        
        .chart-value {
            position: absolute;
            top: -25px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 12px;
        }
    </style>
    <!-- 先載入所有資料檔案 -->
    <script src="./data/CharacterData.js"></script>
    <script src="./data/TreasureCardData.js"></script>
    <script src="./data/EquipmentData.js"></script>
    <script src="./data/AssistData.js"></script>
    <script src="./data/AssistEquipmentData.js"></script>
    <script src="./data/AssistTreasureCardData.js"></script>
    <!-- 載入映射表 -->
    <script src="./js/filenameMapping.js"></script>
    <!-- 再載入功能模組 -->
    <script src="./js/modal.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3678795487155446"
     crossorigin="anonymous"></script>
</head>
<body>
    <!-- 導航欄 -->
    <div class="nav-tabs">
        <div class="nav-tab active" data-page="page1">潛能計算機</div>
        <div class="nav-tab" data-page="page2">遊戲傷害計算器 - 時間軸版_開發中</div>
    </div>

    <!-- 頁面1: 潛能計算機 -->
    <div id="page1" class="page active">
        <div class="container">
            <!-- 主要選擇區域 -->
            <h3 class="section-title">主要選擇</h3>
            <div class="horizontal-cards-container">
                <!-- 法寶卡 -->
                <div class="card-item">
                    <label>法寶卡</label>
                    <button class="select-button" id="treasureCardButton" onclick="showModal('選擇法寶卡', treasureCardData, 'treasureCardButton')">
                        <div class="button-img">
                            <span class="default-icon">+</span>
                        </div>
                        <div class="button-text">請選擇法寶卡</div>
                    </button>
                </div>
                
                <!-- 角色 -->
                <div class="card-item">
                    <label>角色</label>
                    <button class="select-button" id="characterButton" onclick="showModal('選擇角色', characterData, 'characterButton')">
                        <div class="button-img">
                            <span class="default-icon">+</span>
                        </div>
                        <div class="button-text">請選擇角色</div>
                    </button>
                </div>
                
                <!-- 套裝 -->
                <div class="card-item">
                    <label>套裝</label>
                    <button class="select-button" id="equipmentButton" onclick="showModal('選擇套裝', equipmentData, 'equipmentButton')">
                        <div class="button-img">
                            <span class="default-icon">+</span>
                        </div>
                        <div class="button-text">請選擇套裝</div>
                    </button>
                </div>
            </div>
            
            <div class="reset-button-container">
                <button class="reset-button" onclick="resetAllSelections()">重置</button>
            </div>
    
            <!-- 輔助選擇區域 -->
            <h3 class="section-title">輔助選擇</h3>
            <div class="horizontal-cards-container">
                <!-- 輔助法寶卡 -->
                <div class="card-item">
                    <label>輔助法寶卡</label>
                    <button class="select-button" id="assist1TreasureCardButton" onclick="showModal('選擇輔助法寶卡', assistTreasureCardData, 'assist1TreasureCardButton')">
                        <div class="button-img">
                            <span class="default-icon">+</span>
                        </div>
                        <div class="button-text">請選擇輔助法寶卡</div>
                    </button>
                </div>
                
                <!-- 輔助角色 -->
                <div class="card-item">
                    <label>輔助角色</label>
                    <button class="select-button" id="assist1Button" onclick="showAssistModal('選擇輔助', assistBaseData, 'assist1Button')">
                        <div class="button-img">
                            <span class="default-icon">+</span>
                        </div>
                        <div class="button-text">請選擇輔助</div>
                    </button>
                </div>
                
                <!-- 輔助套裝 -->
                <div class="card-item">
                    <label>輔助套裝</label>
                    <button class="select-button" id="assist1EquipmentButton" onclick="showModal('選擇輔助套裝', assistEquipmentData, 'assist1EquipmentButton')">
                        <div class="button-img">
                            <span class="default-icon">+</span>
                        </div>
                        <div class="button-text">請選擇輔助套裝</div>
                    </button>
                </div>
            </div>
            
            <div id="assist1BoostControls" class="assist-boost-controls">
                <div class="assist-boost-label">增益百分比</div>
                <div class="assist-boost-slider">
                    <input type="range" id="assistBoostSlider" min="0" max="200" value="0" step="0.1" oninput="updateAssistBoost(this.value)">
                    <input type="number" id="assistBoostInput" min="0" max="200" value="0" step="0.1" oninput="updateAssistBoost(this.value)">
                    <span>%</span>
                </div>
                <div class="assist-boost-preview" id="assistBoostPreview">
                    <!-- 動態生成增益預覽 -->
                </div>
            </div>
            
            <!-- 其他內容保持不變 -->
            <table class="result" id="statsTable">
                <tr>
                    <th>屬性</th>
                    <th>角色</th>
                    <th>法寶卡</th>
                    <th>套裝</th>
                    <th>輔助</th>
                    <th>輔助套裝</th>
                    <th>輔助法寶卡</th>
                    <th>總和</th>
                </tr>
            </table>
            
            <div id="potentialResult"></div>
            
            <!-- 潛能點數分配界面 -->
            <div class="potential-allocation-card">
                <div class="card-header">
                    <h3>潛能點數分配</h3>
                    <div class="points-counter">
                        <span class="remaining-label">剩餘點數:</span>
                        <span class="remaining-value">8</span>
                        <span class="total-label">/8</span>
                    </div>
                </div>
                
                <div class="allocation-controls">
                    <!-- 基礎攻擊力 -->
                    <div class="stat-slider" data-stat="baseAtk" data-max="2">
                        <div class="slider-header">
                            <div class="stat-info">
                                <label class="stat-name">基礎攻擊力</label>
                                <div class="stat-bonus">+<span class="bonus-value">0</span></div>
                            </div>
                        </div>
                        <div class="point-control">
                            <button class="control-button minus" disabled>-</button>
                            <span class="point-value-display">0</span>
                            <button class="control-button plus">+</button>
                        </div>
                    </div>
                    
                    <!-- 攻擊力百分比 -->
                    <div class="stat-slider" data-stat="atkPercentage" data-max="8">
                        <div class="slider-header">
                            <div class="stat-info">
                                <label class="stat-name">%攻擊力</label>
                                <div class="stat-bonus">+<span class="bonus-value">0%</span></div>
                            </div>
                        </div>
                        <div class="point-control">
                            <button class="control-button minus" disabled>-</button>
                            <span class="point-value-display">0</span>
                            <button class="control-button plus">+</button>
                        </div>
                    </div>
                    
                    <!-- 屬性傷害百分比 -->
                    <div class="stat-slider" data-stat="attributeDamage" data-max="2">
                        <div class="slider-header">
                            <div class="stat-info">
                                <label class="stat-name">屬性傷害</label>
                                <div class="stat-bonus">+<span class="bonus-value">0%</span></div>
                            </div>
                        </div>
                        <div class="point-control">
                            <button class="control-button minus" disabled>-</button>
                            <span class="point-value-display">0</span>
                            <button class="control-button plus">+</button>
                        </div>
                    </div>
                    
                    <!-- 爆擊率 -->
                    <div class="stat-slider" data-stat="critRate" data-max="8">
                        <div class="slider-header">
                            <div class="stat-info">
                                <label class="stat-name">爆擊率</label>
                                <div class="stat-bonus">+<span class="bonus-value">0%</span></div>
                            </div>
                        </div>
                        <div class="point-control">
                            <button class="control-button minus" disabled>-</button>
                            <span class="point-value-display">0</span>
                            <button class="control-button plus">+</button>
                        </div>
                    </div>
                    
                    <!-- 爆擊傷害 -->
                    <div class="stat-slider" data-stat="critDamage" data-max="8">
                        <div class="slider-header">
                            <div class="stat-info">
                                <label class="stat-name">爆擊傷害</label>
                                <div class="stat-bonus">+<span class="bonus-value">0%</span></div>
                            </div>
                        </div>
                        <div class="point-control">
                            <button class="control-button minus" disabled>-</button>
                            <span class="point-value-display">0</span>
                            <button class="control-button plus">+</button>
                        </div>
                    </div>
                    
                    <button class="auto-optimize-btn">
                        <span class="icon">✨</span>
                        <span class="label">自動優化分配</span>
                    </button>
                </div>
            </div>
            
            <!-- 傷害預覽卡片 -->
            <div class="damage-preview-card">
                <h3>傷害預覽</h3>
                
                <div class="damage-value">
                    <div class="current-damage">
                        <span class="value">0</span>
                        <span class="label">預計傷害</span>
                    </div>
                    
                    <div class="damage-change positive">
                        <span class="change-arrow">↑</span>
                        <span class="change-value">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 頁面2: 遊戲傷害計算器 - 時間軸版 -->
    <div id="page2" class="page">
        <div class="container">
            <h3 class="section-title">遊戲傷害計算器 - 時間軸版</h3>
            
            <!-- 控制區 -->
            <div class="timeline-controls">
                <!-- 添加攻擊區域 -->
                <div class="control-section">
                    <h4>攻擊設定</h4>
                    <div class="control-row">
                        <div class="control-group">
                            <label for="attackName">攻擊名稱</label>
                            <input type="text" id="attackName" placeholder="輸入攻擊名稱">
                        </div>
                        <div class="control-group">
                            <label for="attackDamage">基礎傷害</label>
                            <input type="number" id="attackDamage" placeholder="輸入傷害值" min="0">
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-group">
                            <label for="attackTime">時間點 (秒)</label>
                            <input type="number" id="attackTime" placeholder="輸入時間" min="0" step="0.1">
                        </div>
                        <div class="control-group">
                            <label for="attackType">攻擊類型</label>
                            <select id="attackType">
                                <option value="normal">普通攻擊</option>
                                <option value="skill">技能攻擊</option>
                                <option value="ultimate">絕技</option>
                            </select>
                        </div>
                    </div>
                    <button id="add-attack" class="action-button add-button">添加攻擊</button>
                </div>
                
                <!-- 添加增益區域 -->
                <div class="control-section">
                    <h4>增益效果</h4>
                    <div class="control-row">
                        <div class="control-group">
                            <label for="buffName">增益名稱</label>
                            <input type="text" id="buffName" placeholder="輸入增益名稱">
                        </div>
                        <div class="control-group">
                            <label for="buffEffect">增益效果 (%)</label>
                            <input type="number" id="buffEffect" placeholder="增益百分比" min="0">
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-group">
                            <label for="buffStartTime">開始時間 (秒)</label>
                            <input type="number" id="buffStartTime" placeholder="開始時間" min="0" step="0.1">
                        </div>
                        <div class="control-group">
                            <label for="buffDuration">持續時間 (秒)</label>
                            <input type="number" id="buffDuration" placeholder="持續時間" min="0" step="0.1">
                        </div>
                    </div>
                    <button id="add-buff" class="action-button add-button">添加增益</button>
                </div>
            </div>
            
            <!-- 攻擊和增益列表 -->
            <div class="timeline-lists">
                <div class="list-section">
                    <h4>攻擊列表</h4>
                    <div id="attack-list" class="item-list"></div>
                </div>
                <div class="list-section">
                    <h4>增益列表</h4>
                    <div id="buff-list" class="item-list"></div>
                </div>
            </div>
            
            <!-- 時間軸視覺化 -->
            <div class="timeline-container">
                <h4>時間軸</h4>
                <div class="timeline-header">
                    <span>0秒</span>
                    <span>5秒</span>
                    <span>10秒</span>
                    <span>15秒</span>
                    <span>20秒</span>
                    <span>25秒</span>
                    <span>30秒</span>
                </div>
                <div id="timeline-visualization" class="timeline-visualization">
                    <div class="timeline-ruler"></div>
                    <div id="attack-markers" class="timeline-markers"></div>
                    <div id="buff-areas" class="timeline-areas"></div>
                </div>
            </div>
            
            <!-- 傷害統計 -->
            <div class="damage-stats">
                <h4>傷害統計</h4>
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-title">總傷害</div>
                        <div class="stat-value" id="total-damage">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">最高單次傷害</div>
                        <div class="stat-value" id="max-damage">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">DPS</div>
                        <div class="stat-value" id="dps-value">0</div>
                    </div>
                </div>
            </div>
            
            <!-- 方案管理 -->
            <div class="plan-management">
                <h4>方案管理</h4>
                <div class="plan-controls">
                    <div class="plan-group">
                        <input type="text" id="plan-name" placeholder="輸入方案名稱" class="plan-input">
                        <button id="save-plan" class="plan-button save-button">儲存方案</button>
                        <button id="export-plan" class="plan-button export-button">匯出方案</button>
                    </div>
                    <div class="plan-group">
                        <select id="load-plan-select" class="plan-select">
                            <option value="">-- 選擇已儲存方案 --</option>
                        </select>
                        <button id="load-plan" class="plan-button load-button">載入方案</button>
                        <button id="delete-plan" class="plan-button delete-button">刪除方案</button>
                        <button id="import-plan" class="plan-button import-button">匯入方案</button>
                        <input type="file" id="import-file" style="display: none" accept=".json">
                    </div>
                </div>
            </div>
            
            <!-- 方案對比 -->
            <div class="plan-comparison">
                <h4>方案對比</h4>
                <div class="comparison-controls">
                    <div class="comparison-row">
                        <select id="comparison-plan1" class="comparison-select">
                            <option value="">-- 選擇方案1 --</option>
                        </select>
                        <span class="vs-label">VS</span>
                        <select id="comparison-plan2" class="comparison-select">
                            <option value="">-- 選擇方案2 --</option>
                        </select>
                        <button id="compare-plans" class="comparison-button">開始對比</button>
                    </div>
                </div>
                <div id="comparison-result" class="comparison-result"></div>
            </div>
        </div>
    </div>

    <style>
    /* 頁面2的時間軸版樣式 */
    .timeline-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
        width: 100%;
    }
    
    .control-section {
        flex: 1;
        min-width: 300px;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .control-section h4 {
        color: var(--tower-gold);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 5px;
    }
    
    .control-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .control-group {
        flex: 1;
        min-width: 120px;
    }
    
    .control-group label {
        display: block;
        margin-bottom: 5px;
        color: white;
        font-size: 14px;
    }
    
    .control-group input, .control-group select {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
    }
    
    .action-button {
        background-color: var(--tower-blue);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
        width: 100%;
    }
    
    .action-button:hover {
        background-color: #4a7ab7;
        transform: translateY(-2px);
    }
    
    .add-button {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .add-button::before {
        content: "+";
        margin-right: 5px;
        font-size: 18px;
    }
    
    .timeline-lists {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        width: 100%;
        flex-wrap: wrap;
    }
    
    .list-section {
        flex: 1;
        min-width: 300px;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .list-section h4 {
        color: var(--tower-gold);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 5px;
    }
    
    .item-list {
        max-height: 200px;
        overflow-y: auto;
    }
    
    .list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        margin-bottom: 8px;
        transition: all 0.3s ease;
    }
    
    .list-item:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .list-item-info {
        flex: 1;
    }
    
    .list-item-name {
        font-weight: bold;
        color: white;
        margin-bottom: 3px;
    }
    
    .list-item-details {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .list-item-actions {
        display: flex;
        gap: 5px;
    }
    
    .list-item-actions button {
        background-color: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        padding: 5px;
        transition: all 0.3s ease;
        border-radius: 3px;
    }
    
    .list-item-actions button:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
    }
    
    .timeline-container {
        width: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .timeline-container h4 {
        color: var(--tower-gold);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 5px;
    }
    
    .timeline-header {
        display: flex;
        justify-content: space-between;
        color: white;
        margin-bottom: 5px;
        padding: 0 10px;
    }
    
    .timeline-visualization {
        position: relative;
        height: 150px;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
        overflow: hidden;
    }
    
    .timeline-ruler {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        pointer-events: none;
    }
    
    .timeline-ruler::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        height: 1px;
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .timeline-ruler::after {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-image: repeating-linear-gradient(
            90deg,
            transparent,
            transparent calc(100% / 30 - 1px),
            rgba(255, 255, 255, 0.1) calc(100% / 30),
            rgba(255, 255, 255, 0.1) calc(100% / 30 + 1px)
        );
    }
    
    .timeline-markers {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .timeline-marker {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--tower-gold);
        transform: translate(-50%, -50%);
        top: 50%;
        z-index: 2;
    }
    
    .timeline-marker::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 215, 0, 0.3);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    .timeline-marker.normal {
        background-color: #5c8dc9;
    }
    
    .timeline-marker.skill {
        background-color: #9c27b0;
    }
    
    .timeline-marker.ultimate {
        background-color: #ff5722;
    }
    
    .timeline-marker.normal::before {
        background-color: rgba(92, 141, 201, 0.3);
    }
    
    .timeline-marker.skill::before {
        background-color: rgba(156, 39, 176, 0.3);
    }
    
    .timeline-marker.ultimate::before {
        background-color: rgba(255, 87, 34, 0.3);
    }
    
    .timeline-marker::after {
        content: attr(data-label);
        position: absolute;
        top: 15px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        font-size: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 2px 5px;
        border-radius: 3px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .timeline-marker:hover::after {
        opacity: 1;
    }
    
    .timeline-areas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .buff-area {
        position: absolute;
        height: 20px;
        background-color: rgba(76, 175, 80, 0.3);
        border: 1px solid rgba(76, 175, 80, 0.7);
        top: 70px;
        border-radius: 3px;
    }
    
    .buff-area::after {
        content: attr(data-label);
        position: absolute;
        bottom: 22px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        font-size: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 2px 5px;
        border-radius: 3px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .buff-area:hover::after {
        opacity: 1;
    }
    
    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 0.7;
        }
        70% {
            transform: scale(2);
            opacity: 0;
        }
        100% {
            transform: scale(1);
            opacity: 0;
        }
    }
    
    .damage-stats {
        width: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .damage-stats h4 {
        color: var(--tower-gold);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 5px;
    }
    
    .stats-cards {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .stat-card {
        flex: 1;
        min-width: 150px;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }
    
    .stat-title {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin-bottom: 8px;
    }
    
    .stat-value {
        color: white;
        font-size: 24px;
        font-weight: bold;
    }
    </style>

    <script>
    // 時間軸版頁面的JavaScript代碼
    document.addEventListener('DOMContentLoaded', function() {
        // 定義變數
        let attacks = [];
        let buffs = [];
        let nextAttackId = 1;
        let nextBuffId = 1;
        let savedPlans = {};
        
        // 載入已保存的方案
        loadSavedPlans();
        
        // 獲取元素
        const addAttackBtn = document.getElementById('add-attack');
        const addBuffBtn = document.getElementById('add-buff');
        const attackList = document.getElementById('attack-list');
        const buffList = document.getElementById('buff-list');
        const attackMarkers = document.getElementById('attack-markers');
        const buffAreas = document.getElementById('buff-areas');
        const totalDamageEl = document.getElementById('total-damage');
        const maxDamageEl = document.getElementById('max-damage');
        const dpsValueEl = document.getElementById('dps-value');
        
        // 方案管理元素
        const savePlanBtn = document.getElementById('save-plan');
        const loadPlanBtn = document.getElementById('load-plan');
        const deletePlanBtn = document.getElementById('delete-plan');
        const exportPlanBtn = document.getElementById('export-plan');
        const importPlanBtn = document.getElementById('import-plan');
        const importFileInput = document.getElementById('import-file');
        const planNameInput = document.getElementById('plan-name');
        const loadPlanSelect = document.getElementById('load-plan-select');
        
        // 對比元素
        const comparisonPlan1 = document.getElementById('comparison-plan1');
        const comparisonPlan2 = document.getElementById('comparison-plan2');
        const comparePlansBtn = document.getElementById('compare-plans');
        const comparisonResult = document.getElementById('comparison-result');
        
        // 方案管理功能
        savePlanBtn.addEventListener('click', function() {
            const planName = planNameInput.value.trim();
            if (!planName) {
                alert('請輸入方案名稱');
                return;
            }
            
            if (savedPlans[planName] && !confirm(`方案「${planName}」已存在，是否覆蓋？`)) {
                return;
            }
            
            // 保存當前方案
            savedPlans[planName] = {
                attacks: JSON.parse(JSON.stringify(attacks)),
                buffs: JSON.parse(JSON.stringify(buffs)),
                stats: {
                    totalDamage: parseFloat(totalDamageEl.textContent.replace(/,/g, '')),
                    maxDamage: parseFloat(maxDamageEl.textContent.replace(/,/g, '')),
                    dps: parseFloat(dpsValueEl.textContent.replace(/,/g, ''))
                },
                timestamp: new Date().toISOString()
            };
            
            // 儲存到本地存儲
            saveToLocalStorage();
            
            // 更新下拉選單
            updatePlanSelects();
            
            alert(`方案「${planName}」已成功儲存！`);
        });
        
        loadPlanBtn.addEventListener('click', function() {
            const planName = loadPlanSelect.value;
            if (!planName) {
                alert('請選擇要載入的方案');
                return;
            }
            
            const plan = savedPlans[planName];
            if (!plan) {
                alert('找不到該方案');
                return;
            }
            
            // 載入方案數據
            attacks = JSON.parse(JSON.stringify(plan.attacks));
            buffs = JSON.parse(JSON.stringify(plan.buffs));
            
            // 確保ID計數器正確
            nextAttackId = attacks.length > 0 ? Math.max(...attacks.map(a => a.id)) + 1 : 1;
            nextBuffId = buffs.length > 0 ? Math.max(...buffs.map(b => b.id)) + 1 : 1;
            
            // 更新UI
            renderAttackList();
            renderBuffList();
            renderTimeline();
            calculateDamage();
            
            alert(`方案「${planName}」已成功載入！`);
        });
        
        deletePlanBtn.addEventListener('click', function() {
            const planName = loadPlanSelect.value;
            if (!planName) {
                alert('請選擇要刪除的方案');
                return;
            }
            
            if (!confirm(`確定要刪除方案「${planName}」嗎？此操作無法撤銷。`)) {
                return;
            }
            
            // 刪除方案
            delete savedPlans[planName];
            
            // 儲存到本地存儲
            saveToLocalStorage();
            
            // 更新下拉選單
            updatePlanSelects();
            
            alert(`方案「${planName}」已成功刪除！`);
        });
        
        exportPlanBtn.addEventListener('click', function() {
            const planName = planNameInput.value.trim();
            if (!planName) {
                alert('請輸入方案名稱以便匯出');
                return;
            }
            
            // 建立臨時方案或使用已存在的
            const planToExport = savedPlans[planName] || {
                attacks: JSON.parse(JSON.stringify(attacks)),
                buffs: JSON.parse(JSON.stringify(buffs)),
                stats: {
                    totalDamage: parseFloat(totalDamageEl.textContent.replace(/,/g, '')),
                    maxDamage: parseFloat(maxDamageEl.textContent.replace(/,/g, '')),
                    dps: parseFloat(dpsValueEl.textContent.replace(/,/g, ''))
                },
                timestamp: new Date().toISOString()
            };
            
            // 將方案轉換為JSON
            const planJson = JSON.stringify({
                name: planName,
                plan: planToExport
            });
            
            // 創建下載連結
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(planJson);
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", planName + "_攻擊方案.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        });
        
        importPlanBtn.addEventListener('click', function() {
            importFileInput.click();
        });
        
        importFileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    const planName = importedData.name;
                    const plan = importedData.plan;
                    
                    if (!planName || !plan || !plan.attacks || !plan.buffs) {
                        throw new Error('無效的方案檔案格式');
                    }
                    
                    // 詢問是否覆蓋
                    if (savedPlans[planName] && !confirm(`方案「${planName}」已存在，是否覆蓋？`)) {
                        return;
                    }
                    
                    // 儲存匯入的方案
                    savedPlans[planName] = plan;
                    
                    // 儲存到本地存儲
                    saveToLocalStorage();
                    
                    // 更新下拉選單
                    updatePlanSelects();
                    
                    // 自動選擇剛匯入的方案
                    loadPlanSelect.value = planName;
                    planNameInput.value = planName;
                    
                    alert(`方案「${planName}」已成功匯入！`);
                } catch (error) {
                    alert('匯入失敗：' + error.message);
                }
            };
            reader.readAsText(file);
            
            // 清除檔案輸入，使得可以重複匯入同一個檔案
            event.target.value = '';
        });
        
        // 方案對比
        comparePlansBtn.addEventListener('click', function() {
            const plan1Name = comparisonPlan1.value;
            const plan2Name = comparisonPlan2.value;
            
            if (!plan1Name || !plan2Name) {
                alert('請選擇要對比的兩個方案');
                return;
            }
            
            if (plan1Name === plan2Name) {
                alert('請選擇兩個不同的方案進行對比');
                return;
            }
            
            const plan1 = savedPlans[plan1Name];
            const plan2 = savedPlans[plan2Name];
            
            if (!plan1 || !plan2) {
                alert('無法找到選定的方案');
                return;
            }
            
            // 計算對比數據
            const comparisonData = {
                totalDamage: {
                    plan1: plan1.stats.totalDamage,
                    plan2: plan2.stats.totalDamage,
                    diff: plan1.stats.totalDamage - plan2.stats.totalDamage,
                    diffPercent: ((plan1.stats.totalDamage / plan2.stats.totalDamage) - 1) * 100
                },
                maxDamage: {
                    plan1: plan1.stats.maxDamage,
                    plan2: plan2.stats.maxDamage,
                    diff: plan1.stats.maxDamage - plan2.stats.maxDamage,
                    diffPercent: ((plan1.stats.maxDamage / plan2.stats.maxDamage) - 1) * 100
                },
                dps: {
                    plan1: plan1.stats.dps,
                    plan2: plan2.stats.dps,
                    diff: plan1.stats.dps - plan2.stats.dps,
                    diffPercent: ((plan1.stats.dps / plan2.stats.dps) - 1) * 100
                },
                attackCount: {
                    plan1: plan1.attacks.length,
                    plan2: plan2.attacks.length,
                    diff: plan1.attacks.length - plan2.attacks.length
                },
                buffCount: {
                    plan1: plan1.buffs.length,
                    plan2: plan2.buffs.length,
                    diff: plan1.buffs.length - plan2.buffs.length
                }
            };
            
            // 生成對比結果HTML
            let resultHTML = `
                <h3>「${plan1Name}」vs「${plan2Name}」對比結果</h3>
                <table class="comparison-table">
                    <tr>
                        <th>指標</th>
                        <th>${plan1Name}</th>
                        <th>${plan2Name}</th>
                        <th>差異</th>
                    </tr>
                    <tr>
                        <td class="comparison-metric">總傷害</td>
                        <td class="${comparisonData.totalDamage.diff > 0 ? 'better-value' : comparisonData.totalDamage.diff < 0 ? 'worse-value' : ''}">${Math.round(comparisonData.totalDamage.plan1).toLocaleString()}</td>
                        <td class="${comparisonData.totalDamage.diff < 0 ? 'better-value' : comparisonData.totalDamage.diff > 0 ? 'worse-value' : ''}">${Math.round(comparisonData.totalDamage.plan2).toLocaleString()}</td>
                        <td>${comparisonData.totalDamage.diff > 0 ? '+' : ''}${Math.round(comparisonData.totalDamage.diff).toLocaleString()} (${comparisonData.totalDamage.diffPercent > 0 ? '+' : ''}${comparisonData.totalDamage.diffPercent.toFixed(2)}%)</td>
                    </tr>
                    <tr>
                        <td class="comparison-metric">最高單次傷害</td>
                        <td class="${comparisonData.maxDamage.diff > 0 ? 'better-value' : comparisonData.maxDamage.diff < 0 ? 'worse-value' : ''}">${Math.round(comparisonData.maxDamage.plan1).toLocaleString()}</td>
                        <td class="${comparisonData.maxDamage.diff < 0 ? 'better-value' : comparisonData.maxDamage.diff > 0 ? 'worse-value' : ''}">${Math.round(comparisonData.maxDamage.plan2).toLocaleString()}</td>
                        <td>${comparisonData.maxDamage.diff > 0 ? '+' : ''}${Math.round(comparisonData.maxDamage.diff).toLocaleString()} (${comparisonData.maxDamage.diffPercent > 0 ? '+' : ''}${comparisonData.maxDamage.diffPercent.toFixed(2)}%)</td>
                    </tr>
                    <tr>
                        <td class="comparison-metric">DPS</td>
                        <td class="${comparisonData.dps.diff > 0 ? 'better-value' : comparisonData.dps.diff < 0 ? 'worse-value' : ''}">${Math.round(comparisonData.dps.plan1).toLocaleString()}</td>
                        <td class="${comparisonData.dps.diff < 0 ? 'better-value' : comparisonData.dps.diff > 0 ? 'worse-value' : ''}">${Math.round(comparisonData.dps.plan2).toLocaleString()}</td>
                        <td>${comparisonData.dps.diff > 0 ? '+' : ''}${Math.round(comparisonData.dps.diff).toLocaleString()} (${comparisonData.dps.diffPercent > 0 ? '+' : ''}${comparisonData.dps.diffPercent.toFixed(2)}%)</td>
                    </tr>
                    <tr>
                        <td class="comparison-metric">攻擊次數</td>
                        <td>${comparisonData.attackCount.plan1}</td>
                        <td>${comparisonData.attackCount.plan2}</td>
                        <td>${comparisonData.attackCount.diff > 0 ? '+' : ''}${comparisonData.attackCount.diff}</td>
                    </tr>
                    <tr>
                        <td class="comparison-metric">增益數量</td>
                        <td>${comparisonData.buffCount.plan1}</td>
                        <td>${comparisonData.buffCount.plan2}</td>
                        <td>${comparisonData.buffCount.diff > 0 ? '+' : ''}${comparisonData.buffCount.diff}</td>
                    </tr>
                </table>
                
                <div class="comparison-chart">
                    <div class="chart-bar" id="chart-plan1" style="left: 25%; height: ${Math.min(200, (comparisonData.totalDamage.plan1 / Math.max(comparisonData.totalDamage.plan1, comparisonData.totalDamage.plan2)) * 200)}px">
                        <div class="chart-bar-label">${plan1Name}</div>
                        <div class="chart-value">${Math.round(comparisonData.totalDamage.plan1).toLocaleString()}</div>
                    </div>
                    <div class="chart-bar" id="chart-plan2" style="left: 65%; height: ${Math.min(200, (comparisonData.totalDamage.plan2 / Math.max(comparisonData.totalDamage.plan1, comparisonData.totalDamage.plan2)) * 200)}px">
                        <div class="chart-bar-label">${plan2Name}</div>
                        <div class="chart-value">${Math.round(comparisonData.totalDamage.plan2).toLocaleString()}</div>
                    </div>
                </div>
                
                <div class="comparison-summary">
                    <h4>總結</h4>
                    <p>
                        在總傷害方面，「${plan1Name}」${comparisonData.totalDamage.diff > 0 ? '優於' : '劣於'}「${plan2Name}」${Math.abs(comparisonData.totalDamage.diffPercent).toFixed(2)}%。
                        在DPS方面，「${plan1Name}」${comparisonData.dps.diff > 0 ? '優於' : '劣於'}「${plan2Name}」${Math.abs(comparisonData.dps.diffPercent).toFixed(2)}%。
                    </p>
                    <p>
                        綜合來看，
                        ${
                            comparisonData.totalDamage.diff > 0 && comparisonData.dps.diff > 0 
                            ? `「${plan1Name}」在總傷害和DPS上均優於「${plan2Name}」，建議優先使用「${plan1Name}」方案。` 
                            : comparisonData.totalDamage.diff < 0 && comparisonData.dps.diff < 0 
                            ? `「${plan2Name}」在總傷害和DPS上均優於「${plan1Name}」，建議優先使用「${plan2Name}」方案。`
                            : `兩個方案各有優勢，「${plan1Name}」在${comparisonData.totalDamage.diff > 0 ? '總傷害' : 'DPS'}上表現更好，而「${plan2Name}」在${comparisonData.totalDamage.diff < 0 ? '總傷害' : 'DPS'}上表現更好，可根據實際戰鬥需求選擇合適的方案。`
                        }
                    </p>
                </div>
            `;
            
            // 顯示對比結果
            comparisonResult.innerHTML = resultHTML;
            comparisonResult.classList.add('active');
        });
        
        // 添加攻擊
        addAttackBtn.addEventListener('click', function() {
            const name = document.getElementById('attackName').value.trim() || `攻擊 ${nextAttackId}`;
            const damage = parseFloat(document.getElementById('attackDamage').value) || 0;
            const time = parseFloat(document.getElementById('attackTime').value) || 0;
            const type = document.getElementById('attackType').value;
            
            if (damage <= 0) {
                alert('請輸入有效的傷害值');
                return;
            }
            
            const attackId = nextAttackId++;
            const attack = {
                id: attackId,
                name: name,
                damage: damage,
                time: time,
                type: type
            };
            
            attacks.push(attack);
            renderAttackList();
            renderTimeline();
            calculateDamage();
            
            // 清空輸入
            document.getElementById('attackName').value = '';
            document.getElementById('attackDamage').value = '';
            document.getElementById('attackTime').value = '';
        });
        
        // 添加增益
        addBuffBtn.addEventListener('click', function() {
            const name = document.getElementById('buffName').value.trim() || `增益 ${nextBuffId}`;
            const effect = parseFloat(document.getElementById('buffEffect').value) || 0;
            const startTime = parseFloat(document.getElementById('buffStartTime').value) || 0;
            const duration = parseFloat(document.getElementById('buffDuration').value) || 0;
            
            if (effect <= 0) {
                alert('請輸入有效的增益效果');
                return;
            }
            
            if (duration <= 0) {
                alert('請輸入有效的持續時間');
                return;
            }
            
            const buffId = nextBuffId++;
            const buff = {
                id: buffId,
                name: name,
                effect: effect / 100, // 轉換為小數
                startTime: startTime,
                duration: duration,
                endTime: startTime + duration
            };
            
            buffs.push(buff);
            renderBuffList();
            renderTimeline();
            calculateDamage();
            
            // 清空輸入
            document.getElementById('buffName').value = '';
            document.getElementById('buffEffect').value = '';
            document.getElementById('buffStartTime').value = '';
            document.getElementById('buffDuration').value = '';
        });
        
        // 輔助函數
        function loadSavedPlans() {
            const savedPlansJson = localStorage.getItem('timeline-damage-plans');
            if (savedPlansJson) {
                try {
                    savedPlans = JSON.parse(savedPlansJson);
                    updatePlanSelects();
                } catch (e) {
                    console.error('載入已儲存方案失敗:', e);
                    savedPlans = {};
                }
            }
        }
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('timeline-damage-plans', JSON.stringify(savedPlans));
            } catch (e) {
                console.error('儲存方案到本地儲存失敗:', e);
                alert('儲存失敗: ' + e.message);
            }
        }
        
        function updatePlanSelects() {
            // 清空選項
            loadPlanSelect.innerHTML = '<option value="">-- 選擇已儲存方案 --</option>';
            comparisonPlan1.innerHTML = '<option value="">-- 選擇方案1 --</option>';
            comparisonPlan2.innerHTML = '<option value="">-- 選擇方案2 --</option>';
            
            // 添加方案選項
            for (const planName in savedPlans) {
                // 為載入選單添加選項
                const option = document.createElement('option');
                option.value = planName;
                option.textContent = planName;
                loadPlanSelect.appendChild(option);
                
                // 為對比選單1添加選項
                const option1 = document.createElement('option');
                option1.value = planName;
                option1.textContent = planName;
                comparisonPlan1.appendChild(option1);
                
                // 為對比選單2添加選項
                const option2 = document.createElement('option');
                option2.value = planName;
                option2.textContent = planName;
                comparisonPlan2.appendChild(option2);
            }
        }
        
        // 渲染攻擊列表
        function renderAttackList() {
            attackList.innerHTML = '';
            attacks.sort((a, b) => a.time - b.time).forEach(attack => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="list-item-info">
                        <div class="list-item-name">${attack.name}</div>
                        <div class="list-item-details">
                            傷害: ${attack.damage.toLocaleString()} | 時間: ${attack.time}秒 | 類型: ${getAttackTypeName(attack.type)}
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button onclick="editAttack(${attack.id})">編輯</button>
                        <button onclick="deleteAttack(${attack.id})">刪除</button>
                    </div>
                `;
                attackList.appendChild(item);
            });
        }
        
        // 渲染增益列表
        function renderBuffList() {
            buffList.innerHTML = '';
            buffs.sort((a, b) => a.startTime - b.startTime).forEach(buff => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="list-item-info">
                        <div class="list-item-name">${buff.name}</div>
                        <div class="list-item-details">
                            效果: +${(buff.effect * 100).toFixed(1)}% | 開始: ${buff.startTime}秒 | 持續: ${buff.duration}秒
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button onclick="editBuff(${buff.id})">編輯</button>
                        <button onclick="deleteBuff(${buff.id})">刪除</button>
                    </div>
                `;
                buffList.appendChild(item);
            });
        }
        
        // 渲染時間軸
        function renderTimeline() {
            attackMarkers.innerHTML = '';
            buffAreas.innerHTML = '';
            
            // 設置時間軸總長為30秒
            const timelineWidth = document.querySelector('.timeline-visualization').offsetWidth;
            const secondWidth = timelineWidth / 30;
            
            // 渲染攻擊標記
            attacks.forEach(attack => {
                const marker = document.createElement('div');
                marker.className = `timeline-marker ${attack.type}`;
                marker.style.left = `${(attack.time / 30) * 100}%`;
                marker.setAttribute('data-label', `${attack.name} (${attack.damage.toLocaleString()})`);
                attackMarkers.appendChild(marker);
            });
            
            // 渲染增益區域
            buffs.forEach(buff => {
                const area = document.createElement('div');
                area.className = 'buff-area';
                area.style.left = `${(buff.startTime / 30) * 100}%`;
                area.style.width = `${(buff.duration / 30) * 100}%`;
                area.setAttribute('data-label', `${buff.name} (+${(buff.effect * 100).toFixed(1)}%)`);
                buffAreas.appendChild(area);
            });
        }
        
        // 計算傷害
        function calculateDamage() {
            if (attacks.length === 0) {
                totalDamageEl.textContent = '0';
                maxDamageEl.textContent = '0';
                dpsValueEl.textContent = '0';
                return;
            }
            
            let totalDamage = 0;
            let maxDamage = 0;
            
            // 計算每次攻擊的最終傷害（考慮增益）
            attacks.forEach(attack => {
                // 獲取該時間點的所有生效增益
                const activeBuffs = buffs.filter(
                    buff => attack.time >= buff.startTime && attack.time < buff.endTime
                );
                
                // 計算增益倍率
                let buffMultiplier = 1;
                activeBuffs.forEach(buff => {
                    buffMultiplier *= (1 + buff.effect);
                });
                
                // 計算最終傷害
                const finalDamage = attack.damage * buffMultiplier;
                totalDamage += finalDamage;
                
                // 更新最高傷害
                if (finalDamage > maxDamage) {
                    maxDamage = finalDamage;
                }
            });
            
            // 計算最大時間點（用於DPS計算）
            const maxTime = Math.max(...attacks.map(a => a.time));
            const dps = maxTime > 0 ? totalDamage / maxTime : totalDamage;
            
            // 更新顯示
            totalDamageEl.textContent = Math.round(totalDamage).toLocaleString();
            maxDamageEl.textContent = Math.round(maxDamage).toLocaleString();
            dpsValueEl.textContent = Math.round(dps).toLocaleString();
        }
        
        // 獲取攻擊類型名稱
        function getAttackTypeName(type) {
            switch(type) {
                case 'normal': return '普通攻擊';
                case 'skill': return '技能攻擊';
                case 'ultimate': return '絕技';
                default: return '未知';
            }
        }
        
        // 添加全局刪除和編輯函數
        window.editAttack = function(id) {
            const attack = attacks.find(a => a.id === id);
            if (!attack) return;
            
            document.getElementById('attackName').value = attack.name;
            document.getElementById('attackDamage').value = attack.damage;
            document.getElementById('attackTime').value = attack.time;
            document.getElementById('attackType').value = attack.type;
            
            // 刪除原有攻擊
            deleteAttack(id);
        };
        
        window.deleteAttack = function(id) {
            attacks = attacks.filter(a => a.id !== id);
            renderAttackList();
            renderTimeline();
            calculateDamage();
        };
        
        window.editBuff = function(id) {
            const buff = buffs.find(b => b.id === id);
            if (!buff) return;
            
            document.getElementById('buffName').value = buff.name;
            document.getElementById('buffEffect').value = buff.effect * 100;
            document.getElementById('buffStartTime').value = buff.startTime;
            document.getElementById('buffDuration').value = buff.duration;
            
            // 刪除原有增益
            deleteBuff(id);
        };
        
        window.deleteBuff = function(id) {
            buffs = buffs.filter(b => b.id !== id);
            renderBuffList();
            renderTimeline();
            calculateDamage();
        };
        
        // 初始化
        renderAttackList();
        renderBuffList();
        renderTimeline();
        calculateDamage();
    });
    </script>

    <!-- 模態框 -->
    <div id="selectionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('selectionModal').style.display='none'">&times;</span>
            <h2 id="modalTitle"></h2>
            <div class="modal-search">
                <input type="text" id="optionSearchInput" placeholder="搜尋名稱...">
            </div>
            <div id="optionsGrid" class="option-grid"></div>
        </div>
    </div>

    <script>
        const statsData = [
            { name: '基础攻击力', id: 'baseAtk' },
            { name: '%攻击力', id: 'atkPercentage' },
            { name: '属性伤害', id: 'attributeDamage' },
            { name: '暴击率', id: 'critRate' },
            { name: '暴击伤害', id: 'critDamage' }
        ];
        
        // 全局變量用於保存當前選擇的輔助及其增益值
        let currentAssist = null;
        let currentBoostPercentage = 0;

        // 生成表格
        function generateTable() {
            const table = document.getElementById('statsTable');
            while (table.rows.length > 1) table.deleteRow(1);
            statsData.forEach(stat => {
                const row = table.insertRow();
                row.insertCell().textContent = stat.name;
                ['Character', 'Card', 'Equipment', 'Assist1', 'Assist1Equipment', 'Assist1TreasureCard', 'Sum'].forEach(source => {
                    row.insertCell().id = `${stat.id}${source}`;
                });
            });
        }

        // 輔助角色選擇的特殊模態框顯示函數
        function showAssistModal(title, data, buttonId) {
            document.getElementById('modalTitle').textContent = title;
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            // 先移除所有已存在的說明文字元素，避免顯示角色的說明文字
            const existingNotes = document.querySelectorAll('.modal-note');
            existingNotes.forEach(note => note.remove());
            
            // 獲取當前選擇的值
            const currentSelectedValue = getSelectedValue(buttonId);
            
            for (const key in data) {
                const item = document.createElement('div');
                item.className = 'option-item';
                
                if (data[key].image) {
                    const img = document.createElement('img');
                    img.src = getImagePath(data[key].image);
                    img.alt = key;
                    item.appendChild(img);
                }
                
                const name = document.createElement('div');
                name.textContent = key;
                item.appendChild(name);
                
                // 如果當前項目是已選擇的項目，添加選中樣式
                if (key === currentSelectedValue && !currentSelectedValue.includes('請選擇')) {
                    item.classList.add('selected');
                }
                
                item.addEventListener('click', () => {
                    // 保存當前選擇的輔助
                    currentAssist = key;
                    
                    // 更新按鈕文本
                    const button = document.getElementById(buttonId);
                    button.innerHTML = `
                        <div class="button-img">
                            ${data[key].image ? `<img src="${getImagePath(data[key].image)}" alt="${key}">` : '<span class="default-icon">+</span>'}
                        </div>
                        <div class="button-text">${key}</div>
                    `;
                    
                    document.getElementById('selectionModal').style.display = 'none';
                    
                    // 顯示增益控制面板
                    document.getElementById('assist1BoostControls').classList.add('active');
                    
                    // 重置增益值
                    currentBoostPercentage = 0;
                    document.getElementById('assistBoostSlider').value = 0;
                    document.getElementById('assistBoostInput').value = 0;
                    
                    // 更新增益預覽
                    updateAssistBoostPreview();
                    
                    // 計算總屬性
                    calculate();
                });
                
                optionsGrid.appendChild(item);
            }
            
            document.getElementById('selectionModal').style.display = 'block';
        }
        
        // 常规模态框显示函数，用于非輔助的选择
        function showModal(title, data, buttonId) {
            document.getElementById('modalTitle').textContent = title;
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            // 先移除所有已存在的說明文字元素
            const existingNotes = document.querySelectorAll('.modal-note');
            existingNotes.forEach(note => note.remove());
            
            // 根據不同按鈕類型添加不同說明文字
            if (buttonId === 'characterButton') {
                const noteElement = document.createElement('div');
                noteElement.className = 'modal-note';
                noteElement.innerHTML = '<i class="note-icon">ℹ️</i> 武器(52%攻)和潛能套裝效果(30%屬傷,20基礎攻擊力)放在角色數值中';
                document.querySelector('.modal-search').insertAdjacentElement('beforebegin', noteElement);
            } else if (buttonId === 'equipmentButton') {
                const noteElement = document.createElement('div');
                noteElement.className = 'modal-note';
                noteElement.innerHTML = '<i class="note-icon">ℹ️</i> 頭部固有的31.2%屬傷放在套裝數值中';
                document.querySelector('.modal-search').insertAdjacentElement('beforebegin', noteElement);
            }
            
            // 獲取當前選擇的值
            const currentSelectedValue = getSelectedValue(buttonId);
            
            for (const key in data) {
                const item = document.createElement('div');
                item.className = 'option-item';
                
                if (data[key].image) {
                    const img = document.createElement('img');
                    img.src = getImagePath(data[key].image);
                    img.alt = key;
                    item.appendChild(img);
                }
                
                const name = document.createElement('div');
                name.textContent = key;
                item.appendChild(name);
                
                // 如果當前項目是已選擇的項目，添加選中樣式
                if (key === currentSelectedValue && !currentSelectedValue.includes('請選擇')) {
                    item.classList.add('selected');
                }
                
                item.addEventListener('click', () => {
                    // 更新按鈕內容，使用新的卡片樣式
                    const button = document.getElementById(buttonId);
                    
                    button.innerHTML = `
                        <div class="button-img">
                            ${data[key].image ? `<img src="${getImagePath(data[key].image)}" alt="${key}">` : '<span class="default-icon">+</span>'}
                        </div>
                        <div class="button-text">${key}</div>
                    `;
                    
                    document.getElementById('selectionModal').style.display = 'none';
                    calculate();
                });
                
                optionsGrid.appendChild(item);
            }
            
            document.getElementById('selectionModal').style.display = 'block';
        }
        
        // 更新輔助角色增益百分比
        function updateAssistBoost(value) {
            // 同步滑動條和輸入框的值，保留一位小數
            value = Math.min(Math.max(parseFloat(value) || 0, 0), 200);
            value = Math.round(value * 10) / 10; // 確保增益最小單位是 0.1%
            
            document.getElementById('assistBoostSlider').value = value;
            document.getElementById('assistBoostInput').value = value;
            
            // 更新當前增益百分比
            currentBoostPercentage = value;
            
            // 更新增益預覽
            updateAssistBoostPreview();
            
            // 重新計算總屬性
            calculate();
        }
        
        // 更新增益預覽
        function updateAssistBoostPreview() {
            if (!currentAssist || !assistBaseData[currentAssist]) {
                return;
            }
            
            const previewElement = document.getElementById('assistBoostPreview');
            previewElement.innerHTML = '';
            
            const assistData = assistBaseData[currentAssist];
            const boostedStats = assistData.boostedStats || [];
            
            // 為每個可增益的屬性顯示預覽
            boostedStats.forEach(stat => {
                const baseValue = assistData[stat] || 0;
                const boostRatio = (assistData.boostRatio && assistData.boostRatio[stat]) || 0;
                const boostedValue = baseValue + (boostRatio * currentBoostPercentage);
                
                const statItem = document.createElement('div');
                statItem.className = 'boost-stat-item';
                
                const statName = statsData.find(s => s.id === stat)?.name || stat;
                
                let valueText;
                if (stat === 'baseAtk') {
                    valueText = `${formatNumber(baseValue)} → ${formatNumber(boostedValue)}`;
                } else {
                    valueText = `${formatPercentSimple(baseValue)} → ${formatPercentSimple(boostedValue)}`;
                }
                
                // 特別標記屬性傷害和爆擊傷害
                let specialClass = '';
                if (stat === 'attributeDamage' || stat === 'critDamage') {
                    specialClass = 'highlight-stat';
                }
                
                statItem.innerHTML = `
                    <span class="boost-stat-name ${specialClass}">${statName}:</span>
                    <span class="boost-stat-value ${specialClass}">${valueText}</span>
                `;
                
                previewElement.appendChild(statItem);
            });
        }
        
        // 格式化數字，最多顯示到小數點後三位
        function formatNumber(value) {
            if (Number.isInteger(value)) {
                return value.toString();
            }
            
            // 最多顯示到小數點後三位，去除尾部的0
            return parseFloat(value.toFixed(3)).toString();
        }
        
        // 格式化百分比，最多顯示到小數點後三位
        function formatPercent(value) {
            if (value === 0) {
                return '0%';
            }
            
            // 轉換為百分比，最多顯示到小數點後三位，去除尾部的0
            return parseFloat((value * 100).toFixed(3)) + '%';
        }
        
        // 格式化百分比，只顯示到小數點後一位（專用於預覽）
        function formatPercentSimple(value) {
            if (value === 0) {
                return '0%';
            }
            
            // 轉換為百分比，只顯示到小數點後一位
            return parseFloat((value * 100).toFixed(1)) + '%';
        }
        
        // 從按鈕獲取選擇的值
        function getSelectedValue(buttonId) {
            const button = document.getElementById(buttonId);
            // 從 .button-text 中獲取文本
            const textElement = button.querySelector('.button-text');
            if (textElement) {
                return textElement.textContent.trim();
            }
            
            // 如果沒有 .button-text 元素，嘗試獲取原始文本
            let text = '';
            button.childNodes.forEach(node => {
                if (node.nodeType === 3) { // 文本節點
                    text += node.textContent.trim();
                }
            });
            
            return text.trim() || '';
        }
        
        // 計算函數，根據選擇和增益百分比計算總屬性
        function calculate() {
            const selectedCharacter = getSelectedValue('characterButton');
            const selectedTreasureCard = getSelectedValue('treasureCardButton');
            const selectedEquipment = getSelectedValue('equipmentButton');
            const selectedAssist1Equipment = getSelectedValue('assist1EquipmentButton');
            const selectedAssist1TreasureCard = getSelectedValue('assist1TreasureCardButton');

            const character = characterData[selectedCharacter] || {};
            const card = treasureCardData[selectedTreasureCard] || {};
            const equipment = equipmentData[selectedEquipment] || {};
            const assist1Equipment = assistEquipmentData[selectedAssist1Equipment] || {};
            const assist1TreasureCard = assistTreasureCardData[selectedAssist1TreasureCard] || {};
            
            // 獲取帶增益的輔助數據
            let assist1 = {};
            if (currentAssist && assistBaseData[currentAssist]) {
                const baseAssist = assistBaseData[currentAssist];
                
                // 複製基礎屬性
                Object.keys(baseAssist).forEach(key => {
                    if (['baseAtk', 'atkPercentage', 'attributeDamage', 'critRate', 'critDamage'].includes(key)) {
                        assist1[key] = baseAssist[key];
                    }
                });
                
                // 應用增益
                const boostedStats = baseAssist.boostedStats || [];
                boostedStats.forEach(stat => {
                    const boostRatio = (baseAssist.boostRatio && baseAssist.boostRatio[stat]) || 0;
                    assist1[stat] += boostRatio * currentBoostPercentage;
                });
            }

            statsData.forEach(stat => {
                const values = [
                    character[stat.id] || 0,
                    card[stat.id] || 0,
                    equipment[stat.id] || 0,
                    assist1[stat.id] || 0,
                    assist1Equipment[stat.id] || 0,
                    assist1TreasureCard[stat.id] || 0
                ];
                const sum = values.reduce((a, b) => a + b, 0);
                
                document.getElementById(`${stat.id}Character`).textContent = formatValue(values[0], stat.id);
                document.getElementById(`${stat.id}Card`).textContent = formatValue(values[1], stat.id);
                document.getElementById(`${stat.id}Equipment`).textContent = formatValue(values[2], stat.id);
                document.getElementById(`${stat.id}Assist1`).textContent = formatValue(values[3], stat.id);
                document.getElementById(`${stat.id}Assist1Equipment`).textContent = formatValue(values[4], stat.id);
                document.getElementById(`${stat.id}Assist1TreasureCard`).textContent = formatValue(values[5], stat.id);
                document.getElementById(`${stat.id}Sum`).textContent = formatValue(sum, stat.id);
            });

            NewestBaselValue();
            updateDamagePreview();
        }

        // 根據屬性類型格式化顯示值
        function formatValue(value, statId) {
            if (statId === 'baseAtk') {
                return formatNumber(value);
            } else {
                // 在表格中以原始值顯示（不加%）
                return formatNumber(value);
            }
        }

        // 潜力计算函数
        function NewestBaselValue() {
            const selectedCharacter = getSelectedValue('characterButton');
            const selectedTreasureCard = getSelectedValue('treasureCardButton');
            const selectedEquipment = getSelectedValue('equipmentButton');
            const selectedAssist1 = getSelectedValue('assist1Button');
            const selectedAssist1Equipment = getSelectedValue('assist1EquipmentButton');
            const selectedAssist1TreasureCard = getSelectedValue('assist1TreasureCardButton');

            const character = characterData[selectedCharacter] || {};
            const card = treasureCardData[selectedTreasureCard] || {};
            const equipment = equipmentData[selectedEquipment] || {};
            
            // 獲取輔助數據，與calculate()函數保持一致
            let assist1 = {};
            if (currentAssist && assistBaseData[currentAssist]) {
                const baseAssist = assistBaseData[currentAssist];
                
                // 複製基礎屬性
                Object.keys(baseAssist).forEach(key => {
                    if (['baseAtk', 'atkPercentage', 'attributeDamage', 'critRate', 'critDamage'].includes(key)) {
                        assist1[key] = baseAssist[key];
                    }
                });
                
                // 應用增益
                const boostedStats = baseAssist.boostedStats || [];
                boostedStats.forEach(stat => {
                    const boostRatio = (baseAssist.boostRatio && baseAssist.boostRatio[stat]) || 0;
                    assist1[stat] += boostRatio * currentBoostPercentage;
                });
            }
            
            const assist1Equipment = assistEquipmentData[selectedAssist1Equipment] || {};
            const assist1TreasureCard = assistTreasureCardData[selectedAssist1TreasureCard] || {};

            const baseAtk = 
                (character.baseAtk || 0) + 
                (card.baseAtk || 0) + 
                (equipment.baseAtk || 0) + 
                (assist1.baseAtk || 0) + 
                (assist1Equipment.baseAtk || 0) + 
                (assist1TreasureCard.baseAtk || 0);

            const atkPercentage = 
                (character.atkPercentage || 0) + 
                (card.atkPercentage || 0) + 
                (equipment.atkPercentage || 0) + 
                (assist1.atkPercentage || 0) + 
                (assist1Equipment.atkPercentage || 0) + 
                (assist1TreasureCard.atkPercentage || 0);

            const attributeDamage = 
                (character.attributeDamage || 0) + 
                (card.attributeDamage || 0) + 
                (equipment.attributeDamage || 0) + 
                (assist1.attributeDamage || 0) + 
                (assist1Equipment.attributeDamage || 0) + 
                (assist1TreasureCard.attributeDamage || 0);

            const critRate = 
                (character.critRate || 0) + 
                (card.critRate || 0) + 
                (equipment.critRate || 0) + 
                (assist1.critRate || 0) + 
                (assist1Equipment.critRate || 0) + 
                (assist1TreasureCard.critRate || 0);

            const critDamage = 
                (character.critDamage || 0) + 
                (card.critDamage || 0) + 
                (equipment.critDamage || 0) + 
                (assist1.critDamage || 0) + 
                (assist1Equipment.critDamage || 0) + 
                (assist1TreasureCard.critDamage || 0);

            let totalPoints = 8;

            function calculateValue(pointBaseAtk, pointAtkPercentage, pointAttributeDamage, pointCritRate, pointCritDamage) {
                // 限制 PointBaseAtk 和 PointAttributeDamage 的最大值为 2
                pointBaseAtk = Math.min(pointBaseAtk, 2);
                pointAttributeDamage = Math.min(pointAttributeDamage, 2);

                let newBaseAtk = baseAtk + pointBaseAtk * 80.0;
                let newAtkPercentage = atkPercentage + pointAtkPercentage * 0.2;
                let newAttributeDamage = attributeDamage + pointAttributeDamage * 0.15;
                let newCritRate = Math.min(critRate + pointCritRate * 0.15, 1.0);
                let newCritDamage = critDamage + pointCritDamage * 0.25;

                let value = newBaseAtk * (1 + newAtkPercentage) * (1 + newAttributeDamage) * (1 + newCritRate * newCritDamage);
                return value;
            }

            let maxValue = 0;
            let bestPointBaseAtk = 0;
            let bestPointAtkPercentage = 0;
            let bestPointAttributeDamage = 0;
            let bestPointCritRate = 0;
            let bestPointCritDamage = 0;

            for (let pointBaseAtk = 0; pointBaseAtk <= totalPoints; pointBaseAtk++) {
                for (let pointAtkPercentage = 0; pointAtkPercentage <= totalPoints - pointBaseAtk; pointAtkPercentage++) {
                    for (let pointAttributeDamage = 0; pointAttributeDamage <= totalPoints - pointBaseAtk - pointAtkPercentage; pointAttributeDamage++) {
                        for (let pointCritRate = 0; pointCritRate <= totalPoints - pointBaseAtk - pointAtkPercentage - pointAttributeDamage; pointCritRate++) {
                            let pointCritDamage = totalPoints - pointBaseAtk - pointAtkPercentage - pointAttributeDamage - pointCritRate;
                            let value = calculateValue(pointBaseAtk, pointAtkPercentage, pointAttributeDamage, pointCritRate, pointCritDamage);
                            if (value > maxValue) {
                                maxValue = value;
                                bestPointBaseAtk = pointBaseAtk;
                                bestPointAtkPercentage = pointAtkPercentage;
                                bestPointAttributeDamage = pointAttributeDamage;
                                bestPointCritRate = pointCritRate;
                                bestPointCritDamage = pointCritDamage;
                            }
                        }
                    }
                }
            }

            const potentialResultDiv = document.getElementById('potentialResult');
            const maxValueFormatted = Math.round(maxValue * 100) / 100;
            
            const result_html = `
                <div class="max-value">最大傷害值: ${maxValueFormatted}</div>
                <div class="best-distribution">
                    <div class="stat-point"><span class="stat-name">基礎攻擊力:</span><span class="point-value">${bestPointBaseAtk}</span></div>
                    <div class="stat-point"><span class="stat-name">%攻擊力:</span><span class="point-value">${bestPointAtkPercentage}</span></div>
                    <div class="stat-point"><span class="stat-name">屬性傷害:</span><span class="point-value">${bestPointAttributeDamage}</span></div>
                    <div class="stat-point"><span class="stat-name">爆擊率:</span><span class="point-value">${bestPointCritRate}</span></div>
                    <div class="stat-point"><span class="stat-name">爆擊傷害:</span><span class="point-value">${bestPointCritDamage}</span></div>
                </div>
            `;
            potentialResultDiv.innerHTML = result_html;
            
            // 保存最佳加点方案，供自动优化按钮使用
            window.bestDistribution = {
                baseAtk: bestPointBaseAtk,
                atkPercentage: bestPointAtkPercentage,
                attributeDamage: bestPointAttributeDamage,
                critRate: bestPointCritRate,
                critDamage: bestPointCritDamage
            };
            
            // 保存基础属性，供潜能点数预览使用
            window.baseStats = {
                baseAtk,
                atkPercentage, 
                attributeDamage,
                critRate,
                critDamage
            };
            
            return maxValue;
        }
        
        // 潜能点数分配交互逻辑
        function initPotentialAllocation() {
            const totalPoints = 8;
            let usedPoints = 0;
            
            // 更新已使用的点数
            function updateRemainingPoints() {
                usedPoints = 0;
                document.querySelectorAll('.point-value-display').forEach(display => {
                    usedPoints += parseInt(display.textContent);
                });
                
                const remainingPoints = totalPoints - usedPoints;
                document.querySelector('.remaining-value').textContent = remainingPoints;
                
                // 更新按钮状态
                document.querySelectorAll('.stat-slider').forEach(slider => {
                    const value = parseInt(slider.querySelector('.point-value-display').textContent);
                    const minusBtn = slider.querySelector('.control-button.minus');
                    const plusBtn = slider.querySelector('.control-button.plus');
                    const statType = slider.getAttribute('data-stat');
                    
                    // 检查最小值
                    if (value <= 0) {
                        minusBtn.setAttribute('disabled', true);
                        minusBtn.classList.add('disabled');
                    } else {
                        minusBtn.removeAttribute('disabled');
                        minusBtn.classList.remove('disabled');
                    }
                    
                    // 检查最大值和剩余点数
                    let maxValue = parseInt(slider.getAttribute('data-max'));
                    if (statType === 'baseAtk' || statType === 'attributeDamage') {
                        maxValue = Math.min(maxValue, 2);
                    }
                    
                    if (value >= maxValue || remainingPoints <= 0) {
                        plusBtn.setAttribute('disabled', true);
                        plusBtn.classList.add('disabled');
                    } else {
                        plusBtn.removeAttribute('disabled');
                        plusBtn.classList.remove('disabled');
                    }
                });
                
                // 更新预览
                updateDamagePreview();
            }
            
            // 更新加成值显示
            function updateBonusValue(slider) {
                const value = parseInt(slider.querySelector('.point-value-display').textContent);
                const bonusElement = slider.querySelector('.bonus-value');
                const statType = slider.getAttribute('data-stat');
                
                let bonus;
                switch (statType) {
                    case 'baseAtk':
                        bonus = value * 80;
                        bonusElement.textContent = bonus;
                        break;
                    case 'atkPercentage':
                        bonus = (value * 0.2 * 100).toFixed(0);
                        bonusElement.textContent = `${bonus}%`;
                        break;
                    case 'attributeDamage':
                        bonus = (value * 0.15 * 100).toFixed(0);
                        bonusElement.textContent = `${bonus}%`;
                        break;
                    case 'critRate':
                        bonus = (value * 0.15 * 100).toFixed(0);
                        bonusElement.textContent = `${bonus}%`;
                        break;
                    case 'critDamage':
                        bonus = (value * 0.25 * 100).toFixed(0);
                        bonusElement.textContent = `${bonus}%`;
                        break;
                }
            }
            
            // 设置值
            function setValue(slider, newValue) {
                const display = slider.querySelector('.point-value-display');
                const statType = slider.getAttribute('data-stat');
                const currentValue = parseInt(display.textContent);
                
                // 限制特定属性的最大值
                let maxValue = parseInt(slider.getAttribute('data-max'));
                if (statType === 'baseAtk' || statType === 'attributeDamage') {
                    maxValue = Math.min(maxValue, 2);
                }
                
                // 确保值在有效范围内
                newValue = Math.max(0, Math.min(newValue, maxValue));
                
                // 检查是否超出剩余点数
                if (newValue > currentValue && (usedPoints + (newValue - currentValue)) > totalPoints) {
                    newValue = currentValue + (totalPoints - usedPoints);
                }
                
                // 更新显示
                display.textContent = newValue;
                
                // 更新加成值
                updateBonusValue(slider);
                
                // 更新剩余点数和按钮状态
                updateRemainingPoints();
            }
            
            // 设置点击事件
            document.querySelectorAll('.control-button').forEach(button => {
                button.addEventListener('click', () => {
                    if (button.hasAttribute('disabled')) return;
                    
                    const slider = button.closest('.stat-slider');
                    const display = slider.querySelector('.point-value-display');
                    const currentValue = parseInt(display.textContent);
                    
                    if (button.classList.contains('plus')) {
                        // 增加点数
                        setValue(slider, currentValue + 1);
                    } else if (button.classList.contains('minus')) {
                        // 减少点数
                        setValue(slider, currentValue - 1);
                    }
                });
            });
            
            // 自动优化按钮
            document.querySelector('.auto-optimize-btn').addEventListener('click', () => {
                if (!window.bestDistribution) return;
                
                // 应用最佳分配方案
                Object.entries(window.bestDistribution).forEach(([stat, value]) => {
                    const slider = document.querySelector(`.stat-slider[data-stat="${stat}"]`);
                    if (slider) {
                        setValue(slider, value);
                    }
                });
                
                // 添加动画效果
                document.querySelector('.damage-value').classList.add('optimized');
                setTimeout(() => {
                    document.querySelector('.damage-value').classList.remove('optimized');
                }, 1500);
            });
            
            // 初始化
            updateRemainingPoints();
        }
        
        // 更新伤害预览
        function updateDamagePreview() {
            if (!window.baseStats) return;
            
            // 获取基础属性
            const baseStats = window.baseStats;
            
            // 获取当前所有点数分配
            const additionalStats = {};
            document.querySelectorAll('.stat-slider').forEach(slider => {
                const statType = slider.getAttribute('data-stat');
                const value = parseInt(slider.querySelector('.point-value-display').textContent);
                
                switch (statType) {
                    case 'baseAtk':
                        additionalStats.baseAtk = value * 80;
                        break;
                    case 'atkPercentage':
                        additionalStats.atkPercentage = value * 0.2;
                        break;
                    case 'attributeDamage':
                        additionalStats.attributeDamage = value * 0.15;
                        break;
                    case 'critRate':
                        additionalStats.critRate = value * 0.15;
                        break;
                    case 'critDamage':
                        additionalStats.critDamage = value * 0.25;
                        break;
                }
            });
            
            // 计算总伤害
            const totalBaseAtk = baseStats.baseAtk + (additionalStats.baseAtk || 0);
            const totalAtkPercentage = baseStats.atkPercentage + (additionalStats.atkPercentage || 0);
            const totalAttributeDamage = baseStats.attributeDamage + (additionalStats.attributeDamage || 0);
            const totalCritRate = Math.min(baseStats.critRate + (additionalStats.critRate || 0), 1);
            const totalCritDamage = baseStats.critDamage + (additionalStats.critDamage || 0);
            
            const damage = totalBaseAtk * (1 + totalAtkPercentage) * (1 + totalAttributeDamage) * (1 + totalCritRate * totalCritDamage);
            
            // 计算无加点的伤害
            const baseDamage = baseStats.baseAtk * (1 + baseStats.atkPercentage) * (1 + baseStats.attributeDamage) * (1 + baseStats.critRate * baseStats.critDamage);
            
            // 计算提升百分比
            const damageIncrease = damage - baseDamage;
            const damageIncreasePercentage = ((damageIncrease / baseDamage) * 100).toFixed(1);
            
            // 更新显示
            document.querySelector('.current-damage .value').textContent = Math.round(damage).toLocaleString();
            
            const damageChangeElement = document.querySelector('.damage-change');
            damageChangeElement.querySelector('.change-value').textContent = `${damageIncreasePercentage}%`;
            
            if (parseFloat(damageIncreasePercentage) > 0) {
                damageChangeElement.className = 'damage-change positive';
                damageChangeElement.querySelector('.change-arrow').textContent = '↑';
            } else {
                damageChangeElement.className = 'damage-change negative';
                damageChangeElement.querySelector('.change-arrow').textContent = '↓';
            }
        }

        // 重置所有選擇
        function resetAllSelections() {
            // 重設所有按鈕
            document.querySelectorAll('.select-button').forEach(button => {
                const buttonType = button.id.includes('character') ? '角色' : 
                                  button.id.includes('treasureCard') && !button.id.includes('assist') ? '法寶卡' : 
                                  button.id.includes('equipment') && !button.id.includes('assist') ? '套裝' : 
                                  button.id.includes('assist1Button') ? '輔助' : 
                                  button.id.includes('assist1Equipment') ? '輔助套裝' : '輔助法寶卡';
                
                button.innerHTML = `
                    <div class="button-img">
                        <span class="default-icon">+</span>
                    </div>
                    <div class="button-text">請選擇${buttonType}</div>
                `;
            });
            
            // 隱藏輔助增益控制面板
            document.getElementById('assist1BoostControls').classList.remove('active');
            
            // 重置輔助相關變量
            currentAssist = null;
            currentBoostPercentage = 0;
            
            // 重置增益滑動條和輸入框
            if (document.getElementById('assistBoostSlider')) {
                document.getElementById('assistBoostSlider').value = 0;
            }
            if (document.getElementById('assistBoostInput')) {
                document.getElementById('assistBoostInput').value = 0;
            }
            
            // 清空增益預覽
            if (document.getElementById('assistBoostPreview')) {
                document.getElementById('assistBoostPreview').innerHTML = '';
            }
            
            // 清空表格
            statsData.forEach(stat => {
                ['Character', 'Card', 'Equipment', 'Assist1', 'Assist1Equipment', 'Assist1TreasureCard', 'Sum'].forEach(source => {
                    const cell = document.getElementById(`${stat.id}${source}`);
                    if (cell) {
                        cell.textContent = '0';
                    }
                });
            });
            
            // 清空潛能結果
            const potentialResultDiv = document.getElementById('potentialResult');
            if (potentialResultDiv) {
                potentialResultDiv.innerHTML = '';
            }
            
            // 重新計算
            calculate();
        }

        // 添加頁面切換功能
        document.addEventListener('DOMContentLoaded', () => {
            // 原有的初始化代碼
            console.log('DOM 載入完成，開始初始化');
            generateTable();
            calculate(); // 初始化时计算一次
            initPotentialAllocation(); // 初始化潜能点数分配界面
            
            // 新增頁面切換功能
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有tab的active類
                    navTabs.forEach(t => t.classList.remove('active'));
                    // 給當前點擊的tab添加active類
                    tab.classList.add('active');
                    
                    // 隱藏所有頁面
                    document.querySelectorAll('.page').forEach(page => {
                        page.classList.remove('active');
                    });
                    
                    // 顯示對應的頁面
                    const pageId = tab.getAttribute('data-page');
                    document.getElementById(pageId).classList.add('active');
                });
            });
            
            // 輸出映射測試示例（僅用於開發測試）
            if (window.location.search.includes('test_mapping')) {
                console.log("=== 映射測試結果 ===");
                const testCases = [
                    "TOA_image/冰岩.webp",
                    "./image/equipment/屬性套_頭.png",
                    "./image/equipment/甜蜜白糖羽毛_身.png",
                    "TOA_image/作戰開始.webp",
                    "./image/艾爾比.png"
                ];
                
                testCases.forEach(testPath => {
                    const mappedPath = getImagePath(testPath);
                    console.log(`原始路徑: ${testPath}`);
                    console.log(`映射後: ${mappedPath}`);
                    console.log("---");
                });
                
                // 顯示一個測試元素
                const mappingTestDiv = document.createElement('div');
                mappingTestDiv.style.padding = '15px';
                mappingTestDiv.style.margin = '20px auto';
                mappingTestDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                mappingTestDiv.style.color = 'white';
                mappingTestDiv.style.borderRadius = '10px';
                mappingTestDiv.style.maxWidth = '800px';
                
                mappingTestDiv.innerHTML = `
                    <h3>圖片名稱映射測試</h3>
                    <p>以下是測試的映射結果:</p>
                    <ul>
                        ${testCases.map(testPath => `
                            <li>
                                <strong>原始路徑:</strong> ${testPath}<br>
                                <strong>映射後:</strong> ${mappedPath}<br>
                                ${testPath.includes('.webp') || testPath.includes('.png') ? 
                                    `<img src="${mappedPath}" alt="測試圖片" style="max-width:100px; max-height:100px; background:#333; padding:5px; margin:5px 0;">` : 
                                    ''}
                            </li>
                        `).join('')}
                    </ul>
                    <p>要使用映射，您需要將實際文件命名為映射後的英文名稱。例如，如果您有一個 "冰岩.webp" 的中文檔名，實際檔案應命名為 "Frostrock.webp"。</p>
                `;
                
                document.querySelector('.container').appendChild(mappingTestDiv);
            }
            
            // 添加模態框搜尋功能
            const searchInput = document.getElementById('optionSearchInput');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const allOptions = document.querySelectorAll('.option-item');
                
                allOptions.forEach(option => {
                    const name = option.querySelector('div').textContent.toLowerCase();
                    if (name.includes(searchTerm)) {
                        option.style.display = 'flex';
                    } else {
                        option.style.display = 'none';
                    }
                });
            });
            
            // 添加模態框關閉按鈕功能
            document.querySelector('.close').addEventListener('click', function() {
                document.getElementById('selectionModal').style.display = 'none';
            });
            
            // 點擊模態框外部也可以關閉
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('selectionModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            console.log('初始化完成');
        });
    </script>
    <div id="cornerText">Last Updated :2025/04/22</div>
</body>
</html>