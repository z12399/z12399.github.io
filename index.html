<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>角色与法宝卡选择</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

   .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }

        label {
            font-size: 18px;
            margin-bottom: 10px;
        }
    .assist1-container {
             display: flex;
              width: 50%;
             justify-content: center;
        }


        select {
            padding: 5px;
            font-size: 16px;
            margin-bottom: 20px;
        }

   .result {
            font-size: 20px;
            font-weight: bold;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            margin-bottom: 20px;
        }
        
        table {
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid black;
      padding: 5px;
    }

    </style>
    <!-- 抓取資料 -->
    <script src="CharacterData.js"></script>
    <script src="TreasureCardData.js"></script>
    <script src="EquipmentData.js"></script>
</head>

<body>
    <div class="container">
        <!--選擇角色,法寶卡,套裝,和輔助(默認無)-->
        <label for = "characterSelect">角色：</label>
        <select id="characterSelect">
            <option value="NoCharacter">請選擇角色</option>
            <option value="黑麥">黑麥</option>
            <option value="雪花糖球">雪花糖球</option>
            <option value="奶油蘇打">奶油蘇打</option>
            <option value="冰薄荷">冰薄荷</option>
        </select>

        <label for = "treasureCardSelect">法寶卡：</label>
        <select id="treasureCardSelect">
            <option value="NoTreasureCard">請選擇法寶卡</option>
            <option value="黃昏追擊戰">黃昏追擊戰</option>
            <option value="幸福的回憶">幸福的回憶</option>
            <option value="作戰開始">作戰開始</option>
            <option value="雪地飛馳">雪地飛馳</option>
        </select>

        <label for = "equipmentSelect">套裝：</label>
        <select id="equipmentSelect">
            <option value="NoEquipment">請選擇套裝</option>
            <option value="屬性套">屬性套</option>
            <option value="謎樣流浪者">謎樣流浪者</option>
            <option value="詭異的獵人">詭異的獵人</option>
        </select>

        <!--以下為還沒與計算功能連接的代碼 僅有會影響面板的輔助/輔助套裝/法寶卡-->
        <div class="assist1-container">
            
              <label for="assist1Select">輔助一：</label>
              <select id="assist1Select">
                <option value="NoAssist">無/其他</option>
                <option value="NoAssist">檸檬</option>
                <option value="NoAssist">辣椒碎片</option>
                <option value="NoAssist">開心果</option>
              </select>
            
            
              <label for="assist1EquipmentSelect"> 輔助套裝：</label>
              <select id="assist1EquipmentSelect">
                <option value="NoAssist">無/其他</option>
                <option value="AssistEquip1">雪怪</option>
                <option value="AssistEquip2">魔術</option>
              </select>

              <label for="assist1TreasureCardSelect"> 輔助法寶卡：</label>
              <select id="assist1TreasureCardSelect">
                <option value="NoAssist">無/其他</option>
                <option value="AssistEquip1">悠閒的下午</option>
                <option value="AssistEquip2">午夜的華爾滋</option>
              </select>
            
          </div>
        <!--到這-->

        <button onclick="calculate()">計算</button>
        <div id="potentialResult"></div>

    <table class="result">
      <tr>
        <th></th>
        <th>角色</th>
        <th>法宝卡</th>
        <th>套装</th>
        <th>总和</th>
      </tr>
      <tr>
        <td>基础攻击力</td>
        <td id="baseAtkCharacter"></td>
        <td id="baseAtkCard"></td>
        <td id="baseAtkEquipment"></td>
        <td id="baseAtkSum"></td>
      </tr>
      <tr>
        <td>攻击力百分比</td>
        <td id="atkPercentageCharacter"></td>
        <td id="atkPercentageCard"></td>
        <td id="atkPercentageEquipment"></td>
        <td id="atkPercentageSum"></td>
      </tr>
      <tr>
        <td>属性伤害百分比</td>
        <td id="attributeDamageCharacter"></td>
        <td id="attributeDamageCard"></td>
        <td id="attributeDamageEquipment"></td>
        <td id="attributeDamageSum"></td>
      </tr>
      <tr>
        <td>暴击率</td>
        <td id="critRateCharacter"></td>
        <td id="critRateCard"></td>
        <td id="critRateEquipment"></td>
        <td id="critRateSum"></td>
      </tr>
      <tr>
        <td>暴击伤害</td>
        <td id="critDamageCharacter"></td>
        <td id="critDamageCard"></td>
        <td id="critDamageEquipment"></td>
        <td id="critDamageSum"></td>
      </tr>
    </table>
    </div>

    <script>
        // 更新结果，并将抓取结果设定为常量
        const characterSelect = document.getElementById('characterSelect');
        const treasureCardSelect = document.getElementById('treasureCardSelect');
        const equipmentSelect = document.getElementById('equipmentSelect');

        const baseAtkCharacter = document.getElementById('baseAtkCharacter');
        const baseAtkCard = document.getElementById('baseAtkCard');
        const baseAtkEquipment = document.getElementById('baseAtkEquipment');
        const baseAtkSum = document.getElementById('baseAtkSum');

        const atkPercentageCharacter = document.getElementById('atkPercentageCharacter');
        const atkPercentageCard = document.getElementById('atkPercentageCard');
        const atkPercentageEquipment = document.getElementById('atkPercentageEquipment');
        const atkPercentageSum = document.getElementById('atkPercentageSum');

        const attributeDamageCharacter = document.getElementById('attributeDamageCharacter');
        const attributeDamageCard = document.getElementById('attributeDamageCard');
        const attributeDamageEquipment = document.getElementById('attributeDamageEquipment');
        const attributeDamageSum = document.getElementById('attributeDamageSum');

        const critRateCharacter = document.getElementById('critRateCharacter');
        const critRateCard = document.getElementById('critRateCard');
        const critRateEquipment = document.getElementById('critRateEquipment');
        const critRateSum = document.getElementById('critRateSum');

        const critDamageCharacter = document.getElementById('critDamageCharacter');
        const critDamageCard = document.getElementById('critDamageCard');
        const critDamageEquipment = document.getElementById('critDamageEquipment');
        const critDamageSum = document.getElementById('critDamageSum');

        function NewestBaselValue() {
            const selectedCharacter = characterSelect.value;
            const selectedTreasureCard = treasureCardSelect.value;
            const selectedEquipment = equipmentSelect.value;

            const character = characterData[selectedCharacter];
            const card = treasureCardData[selectedTreasureCard];
            const equipment = equipmentData[selectedEquipment];

            baseAtkCharacter.textContent = character['baseAtk'];
            baseAtkCard.textContent = card['baseAtk'];
            baseAtkEquipment.textContent = equipment['baseAtk'];
            const baseAtk = character['baseAtk'] + card['baseAtk'] + equipment['baseAtk'];
            baseAtkSum.textContent = Math.round(baseAtk * 100) / 100;

            atkPercentageCharacter.textContent = character['atkPercentage'];
            atkPercentageCard.textContent = card['atkPercentage'];
            atkPercentageEquipment.textContent = equipment['atkPercentage'];
            const atkPercentage = character['atkPercentage'] + card['atkPercentage'] + equipment['atkPercentage'];
            atkPercentageSum.textContent = Math.round(atkPercentage * 100) / 100;

            attributeDamageCharacter.textContent = character['attributeDamage'];
            attributeDamageCard.textContent = card['attributeDamage'];
            attributeDamageEquipment.textContent = equipment['attributeDamage'];
            const attributeDamage = character['attributeDamage'] + card['attributeDamage'] + equipment['attributeDamage'];
            attributeDamageSum.textContent = Math.round(attributeDamage * 100) / 100;

            critRateCharacter.textContent = Math.round(character['critRate'] * 100) / 100;
            critRateCard.textContent = Math.round(card['critRate'] * 100) / 100;
            critRateEquipment.textContent = Math.round(equipment['critRate'] * 100) / 100;
            const critRate = character['critRate'] + card['critRate'] + equipment['critRate'];
            critRateSum.textContent = Math.round(critRate * 100) / 100;

            critDamageCharacter.textContent = character['critDamage'];
            critDamageCard.textContent = card['critDamage'];
            critDamageEquipment.textContent = equipment['critDamage'];
            const critDamage = character['critDamage'] + card['critDamage'] + equipment['critDamage'];
            critDamageSum.textContent = Math.round(critDamage * 100) / 100;
        }

        characterSelect.addEventListener('change', NewestBaselValue);
        treasureCardSelect.addEventListener('change', NewestBaselValue);
        equipmentSelect.addEventListener('change', NewestBaselValue);

        function calculate() {
            const selectedCharacter = characterSelect.value;
            const selectedTreasureCard = treasureCardSelect.value;
            const selectedEquipment = equipmentSelect.value;

            const character = characterData[selectedCharacter];
            const card = treasureCardData[selectedTreasureCard];
            const equipment = equipmentData[selectedEquipment];

            const baseAtk = character['baseAtk'] + card['baseAtk'] + equipment['baseAtk'];
            const atkPercentage = character['atkPercentage'] + card['atkPercentage'] + equipment['atkPercentage'];
            const attributeDamage = character['attributeDamage'] + card['attributeDamage'] + equipment['attributeDamage'];
            const critRate = character['critRate'] + card['critRate'] + equipment['critRate'];
            const critDamage = character['critDamage'] + card['critDamage'] + equipment['critDamage'];

            let totalPoints = 8;

            function calculateValue(pointBaseAtk, pointAtkPercentage, pointAttributeDamage, pointCritRate, pointCritDamage) {
                let newBaseAtk = baseAtk + pointBaseAtk * 80.0;
                let newAtkPercentage = atkPercentage + pointAtkPercentage * 0.2;
                let newAttributeDamage = attributeDamage + pointAttributeDamage * 0.15;
                let newCritRate = Math.min(critRate + pointCritRate * 0.15, 1.0);
                let newCritDamage = critDamage + pointCritDamage * 0.25;
                return newBaseAtk * (1 + newAtkPercentage) * (1 + newAttributeDamage) * (newCritRate * (1 + newCritDamage) + (1 - newCritRate) * 1);
            }

            let maxValue = 0;
            let bestPointBaseAtk = 0;
            let bestPointAtkPercentage = 0;
            let bestPointAttributeDamage = 0;
            let bestPointCritRate = 0;
            let bestPointCritDamage = 0;

            for (let pointBaseAtk = 0; pointBaseAtk < 3; pointBaseAtk++) {
                for (let pointAtkPercentage = 0; pointAtkPercentage < totalPoints + 1 - pointBaseAtk; pointAtkPercentage++) {
                    for (let pointAttributeDamage = 0; pointAttributeDamage < Math.min(3, totalPoints + 1 - pointBaseAtk - pointAtkPercentage); pointAttributeDamage++) {
                        for (let pointCritRate = 0; pointCritRate < Math.min(totalPoints + 1 - pointBaseAtk - pointAtkPercentage - pointAttributeDamage, Math.floor((1 - critRate) / 0.15) + 1); pointCritRate++) {
                            for (let pointCritDamage = 0; pointCritDamage < totalPoints + 1 - pointBaseAtk - pointAtkPercentage - pointAttributeDamage - pointCritRate; pointCritDamage++) {
                                const currentValue = calculateValue(pointBaseAtk, pointAtkPercentage, pointAttributeDamage, pointCritRate, pointCritDamage);
                                if (currentValue > maxValue) {
                                    maxValue = currentValue;
                                    bestPointBaseAtk = pointBaseAtk;
                                    bestPointAtkPercentage = pointAtkPercentage;
                                    bestPointAttributeDamage = pointAttributeDamage;
                                    bestPointCritRate = pointCritRate;
                                    bestPointCritDamage = pointCritDamage;
                                }
                            }
                        }
                    }
                }
            }

            const potentialResultDiv = document.getElementById('potentialResult');
            const result_text = `Max value: ${Math.round(maxValue * 100) / 100}<br>最佳加点方案：屬性攻擊力 加 ${Math.round(bestPointBaseAtk * 100) / 100} 点，攻擊力百分比 加 ${Math.round(bestPointAtkPercentage * 100) / 100} 点，屬性傷害 加 ${Math.round(bestPointAttributeDamage * 100) / 100} 点，爆擊率 加 ${Math.round(bestPointCritRate * 100) / 100} 点，爆擊傷害 加 ${Math.round(bestPointCritDamage * 100) / 100} 点`;
            potentialResultDiv.innerHTML = result_text;
        }
    </script>
</body>

</html>
